
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Standalone Modes</title>
    <script src="./libs/enable3d.min.js"></script>
  </head>

  <body>
    <div id="info-text">Using enable3d in Standalone Mode</div>
    <script type="module">
        
      const { Project, Scene3D, PhysicsLoader, THREE } = ENABLE3D
      import { EffectComposer } from './three.js-master/examples/jsm/postprocessing/EffectComposer.js';
    import { RenderPass } from './three.js-master/examples/jsm/postprocessing/RenderPass.js';
    import { ShaderPass } from './three.js-master/examples/jsm/postprocessing/ShaderPass.js';
    import { UnrealBloomPass } from './three.js-master/examples/jsm/postprocessing/UnrealBloomPass.js';
    import {OrbitControls} from './three.js-master/examples/jsm/controls/OrbitControls.js'

      var composer, camera, scene;
    
      class MainScene extends Scene3D {
        constructor() {
          super('MainScene')
        }

        init() {
          console.log('init')
        
          this.renderer.setPixelRatio(1)
          this.renderer.setSize(window.innerWidth, window.innerHeight)
        }

        preload() {
          console.log('preload')
        }

        create() {
            console.log('create')
            this.warpSpeed('-sky', '-ground')

            this.camera = new THREE.PerspectiveCamera(60, window.innerWidth/ window.innerHeight, 1, 10000);
            this.camera.position.set(0, 0, 20);
            this.camera.layers.enable(1);

            var controls = new OrbitControls(this.camera, this.renderer.domElement);

            this.renderer.autoClear = false;
            this.renderer.setClearColor( 0x000000 );


            var obj = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 4), new THREE.MeshLambertMaterial({color: 0xf0f0f0, wireframe: false}));
            obj.layers.set(0);
            obj.position.z = 0;
            this.scene.add(obj);

            var obj = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 4), new THREE.MeshLambertMaterial({color: 0xf0f0f0, wireframe: false}));
            obj.layers.set(0);
            obj.position.z = 5;
            this.scene.add(obj);

            // bloomystuff
            var objBloomRed = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 1), new THREE.MeshBasicMaterial({color: 0xff0000, wireframe: false}));
            objBloomRed.position.z = -2.25;
            objBloomRed.layers.set(1);
            this.scene.add(objBloomRed);

            var objBloomWhite = new THREE.Mesh(new THREE.BoxGeometry(5.1, 5.1, 1), new THREE.MeshBasicMaterial({color: 0xffffff, wireframe: false}));
            objBloomWhite.position.z = 2.5;
            objBloomWhite.layers.set(1);
            this.scene.add(objBloomWhite);

            var objBloomGreen = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 1), new THREE.MeshBasicMaterial({color: 0x00ff00, wireframe: false}));
            objBloomGreen.position.z = 7.5;
            objBloomGreen.layers.set(1);
            this.scene.add(objBloomGreen);


            // "fake" objects
            var objRed = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 1), new THREE.MeshBasicMaterial({color: 0xff0000, wireframe: false}));
            objRed.position.z = -2.5;
            objRed.layers.set(0);
            this.scene.add(objRed);

            var objWhite = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 1), new THREE.MeshBasicMaterial({color: 0xffffff, wireframe: false}));
            objWhite.position.z = 2.5;
            objWhite.layers.set(0);
            this.scene.add(objWhite);

            var objGreen = new THREE.Mesh(new THREE.BoxGeometry(5, 5, 1), new THREE.MeshBasicMaterial({color: 0x00ff00, wireframe: false}));
            objGreen.position.z = 7.5;
            objGreen.layers.set(0);
            this.scene.add(objGreen)

            //this.physics.add.existing(obj)
            this.renderScene = new RenderPass( this.scene, this.camera )

            this.bloomPass = new UnrealBloomPass( new THREE.Vector2( window.innerWidth, window.innerHeight ), 1.5, 0.4, 0.85 )
            this.bloomPass.threshold = 0.21
            this.bloomPass.strength = 1.2
            this.bloomPass.radius = 0.55
            this.bloomPass.renderToScreen = true
                
            this.composter = new EffectComposer( this.renderer )
            this.composter.setSize( window.innerWidth, window.innerHeight )
                
            this.composter.addPass( this.renderScene )
            this.composter.addPass( this.bloomPass )
          
        }

        preRender() {
            //console.log("prerender")
            
        }
        postRender() {
            //console.log("postrender")
            this.renderer.clear();
            this.camera.layers.set(1);
            this.composter.render();
            
            this.renderer.clearDepth();
            this.camera.layers.set(0);
            this.renderer.render(this.scene, this.camera);
        }

        update() {
            
        }
        
      }

      PhysicsLoader('./libs/ammo_new', () => {new Project({ scenes: [MainScene], antialias: true })})
    </script>
  </body>
</html>
